<!DOCTYPE html>
<html lang="en">
<head>
    <title>23232</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <script src="../static/boot.js" type="text/javascript"></script>
    <script src="../static/jquery.min.js" type="text/javascript"></script>
    <style type="text/css">
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #div1 {
        }

        .innerdiv {
            padding: 10px;
        }
    </style>
</head>
<body>
<h1>单元格自动计算</h1>


<div id="datagrid1" class="mini-datagrid" style="width:800px;height:280px;"
     idField="id" allowCellEdit="true" allowCellSelect="true" showFooter="false"
     url="../data/grid2.txt"
     ondrawcell="onDrawCell" oncellcommitedit="onCellCommitEdit"
     showSummaryRow="true" ondrawsummarycell="onDrawSummaryCell"
>
    <div property="columns">
        <div field="price" width="120" headerAlign="center" allowSort="true">单价
            <input property="editor" class="mini-textbox" style="width:100%;" vtype="float"/>
        </div>
        <div field="quantity" width="120" headerAlign="center" allowSort="true">数量
            <input property="editor" class="mini-textbox" style="width:100%;" vtype="int"/>
        </div>
        <div field="total" width="120" headerAlign="center" allowSort="true">总计</div>
    </div>
</div>
<script type="text/javascript">
    mini.parse();

    var grid = mini.get("datagrid1");
    grid.load();

    //////////////////////////////////////////
    //提交单元格编辑数据前激发
    function onCellCommitEdit(e) {
        var editor = e.editor;

        editor.validate();
        if (editor.isValid() == false) {
            alert(editor.getErrorText());
            e.cancel = true;
        }
    }

    function onDrawCell(e) {
        var record = e.record;

        if (e.field == "total") {
            var price = record.price;
            var quantity = record.quantity;
            // e.cellHtml = price * quantity;
            e.price = price * 0.3;
            e.quality = quantity * 0.5;
        }

    }

    function onDrawSummaryCell(e) {
        var result = e.result;
        var grid = e.sender;
        var rows = e.data;

        if (e.field == "total") {
            var total = 0;
            for (var i = 0, l = rows.length; i < l; i++) {
                var row = rows[i];
                var t = row.price * row.quantity;
                if (isNaN(t)) continue;
                total += t;
            }

            e.cellHtml = "总计: " + total;
        }
    }

</script>

<div class="description">
    <h3>Description</h3>
    <p>“总计”列的值由“单价”和“数量”相乘而来。</p>
</div>
</body>
<!--<body>-->
<!--<div id="div1" style="width: 100%;height: 100%;background: white;">-->
<!--    <div class="innerdiv" style="height: 16%;background: red">-->
<!--        <div style="width:100%;height:100%;background: yellow">-->

<!--        </div>-->
<!--    </div>-->
<!--    <div class="innerdiv" style="height: 16%; background: grey">-->
<!--        <div style="width:100%;height:100%;background: yellow">-->

<!--        </div>-->
<!--    </div>-->
<!--    <div class="innerdiv" style="height: 16%;background: green">-->
<!--        <div style="width:100%;height:100%;background: yellow">-->

<!--        </div>-->
<!--    </div>-->
<!--    <div class="innerdiv" style="height: 16%;background: blue">-->
<!--        <div style="width:100%;height:100%;background: yellow">-->

<!--        </div>-->

<!--    </div>-->
<!--    <div class="innerdiv" style="height: 16%;background: darkblue">-->
<!--        <div style="width:100%;height:100%;background: yellow">-->

<!--        </div>-->

<!--    </div>-->
<!--    <div class="innerdiv" style="height: 16%;background: saddlebrown">-->
<!--        <div style="width:100%;height:100%;background: yellow">-->

<!--        </div>-->
<!--    </div>-->
<!--    <div class="innerdiv" style="height: 4%;background: coral"></div>-->
<!--</div>-->
<!--</body>-->
<!--<script type="text/javascript">-->
<!--</script>-->
</html>